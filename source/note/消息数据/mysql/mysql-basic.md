## 创建



- varchar使用额外的1到2个字节来存储字符串长度；如果列的最大长度小于或等于255，则使用1个字节，否则使用2个字节；

  ​	以utf-8字符举例，即一个字符占用3个字节；N理论上取到的值是(65535-2)/3=21844。

- char:cahr(1)字符串对于单字节字符来说只会占用1个字节，但是varchar(1)会占用2个字节，其中一个字节用来存储长度信息。

## 查询



## 锁

InnoDB使用的锁类型，分别有：

### 读写锁

- 共享锁（S）和排他锁（X）  都是行级锁

  - 共享锁（S）又称读锁,其他事务可以继续加共享锁,但不能加排他锁

    > 允许持有该锁的事务**读取行**记录。如果事务 T1 拥有记录 r 的 S 锁，事务 T2 对记录 r 加锁请求：若想要加 S 锁，能马上获得；若想要获得 X 锁，则请求会阻塞。

  - 排他锁（X） 又称读锁,其他事务可以继续加共享锁,但不能加排他锁

    > 允许持有该锁的事务**更新或删除**行记录。如果事务 T1 拥有记录 r 的 X 锁，事务 T2 对记录 r 加锁请求：无论想获取 r 的 S 锁或 X 锁都会被阻塞。

    | 锁   | **X** | **S** |
    | ---- | ----- | ----- |
    | X    | 冲突  | 冲突  |
    | S    | 冲突  | 兼容  |

```sql
SELECT ... FROM ... LOCK IN SHARE MODE  #对遇到的所有索引记录加s next-key锁 

SELECT ... FROM ... FOR UPDATE #遇到的所有索引记录加x next-key锁 
```



### 意向锁

- 意向锁（IS和IX）  意向锁是表级锁，表示一个事务之后要获取表中某些行的S锁或X锁

  - 意向共享锁（IS）：事务 T 想要对表 t 中的某些记录加上 S 锁
  - 意向排他锁（IX）：事务 T 想要对表 t 中的某些记录加上 X 锁

  IX，IS是表级锁，不会和行级的X，S锁发生冲突。只会和表级的X，S发生冲突

  例子：
  SELECT ... LOCK IN SHARE MODE，设置了 IS 锁
  SELECT ... FOR UPDATE，设置了 IX 锁

  作用：
  X 和 IS 锁的主要目的是表明：某个请求正在或者将要锁定一行记录。意向锁的作用：意向锁是在添加行锁之前添加。当再向一个表添加表级 X 锁的时候
  如果没有意向锁的话，则需要遍历所有整个表判断是否有行锁的存在，以免发生冲突
  如果有了意向锁，只需要判断该意向锁与即将添加的表级锁是否兼容即可。因为意向锁的存在代表了，有行级锁的存在或者即将有行级锁的存在。因而无需遍历整个表，即可获取结果

- 自增长锁（AUTO-INC Locks）

## 隔离级别

- 脏读：一个事务读取到另一事务未提交的更新数据。
- 不可重复读：在同一事务中,多次读取同一数据返回的结果有所不同。(不可重复读重点在于update和delete)
- 幻读：一个事务读到另一个事务已提交的insert数据。（幻读的重点在于insert ）

| **隔离级别**             | **脏读**   | **不可重复读** | **幻读** |
| ------------------------ | ---------- | -------------- | -------- |
| 未提交读Read uncommitted | 可能       | 可能           | 可能     |
| 已提交读Read committed   | 不可能     | 可能           | 可能     |
| 可重复读Repeatable read  | **不可能** | **不可能**     | **可能** |
| 可串行化serializable     | 不可能     | 不可能         | 不可能   |



- ReadUncommited 

  一般不会用，而且任何操作都不会加锁，就不过多讨论；

- serializable：

  这个级别很简单，读加共享锁，写加排他锁，读写互斥。使用的悲观锁的理论，实现简单，数据更加安全，但是并发能力非常差。在Serializable这个级别，select 还是会加锁的！

- Read Committed (RC)
  快照读忽略，本文不考虑。
  针对当前读，RC隔离级别保证对读取到的记录加锁 (记录锁)，存在幻读现象。

- Repeatable Read (RR)
  快照读忽略，本文不考虑。
  针对当前读，RR隔离级别保证对读取到的记录加锁 (记录锁)，同时保证对读取的范围加锁，新的满足查询条件的记录不能够插入 (间隙锁)，不存在幻读现象。

## 备份

